# –°–µ—Ä–≤–∏—Å –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ Yii2 + Docker

–ü—Ä–æ—Å—Ç–æ–π –∏ –±—ã—Å—Ç—Ä—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, —É—á—ë—Ç–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞ –≤ –∫–æ—Ä–æ—Ç–∫–∏—Ö –∫–æ–¥–∞—Ö –∏ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–æ—Ç–æ–≤.

---

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- –í–≤–æ–¥ –¥–ª–∏–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ ‚Üí –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π (AJAX)
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ—Ä–æ—Ç–∫–∏–π URL: `http://yourdomain/AbC123`
- –£—á—ë—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞: `AbC123 ‚â† abc123`
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–æ—Ç –∂–µ –∫–æ—Ä–æ—Ç–∫–∏–π URL
- –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π 301-—Ä–µ–¥–∏—Ä–µ–∫—Ç
- –ó–∞–ø–∏—Å—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –±–æ—Ç)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ `http://qnits.net/api/checkUserAgent`
- SQL-–∑–∞–ø—Ä–æ—Å –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–æ –º–µ—Å—è—Ü–∞–º –∏ —Ç–æ–ø—É —Å—Å—ã–ª–æ–∫
- –ü–æ–ª–Ω–∞—è Docker-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Nginx + PHP-FPM + MySQL)
- –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone https://github.com/gelo11/shortener.git
cd shortener

# –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose up -d --build

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Yii2
docker-compose exec php composer install

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å HTTP-–∫–ª–∏–µ–Ω—Ç (–¥–ª—è BotDetector)
docker-compose exec php composer require yiisoft/yii2-httpclient

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Codeception (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)
docker-compose exec php composer require --dev codeception/codeception

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose exec php php yii migrate

# –°–æ–∑–¥–∞—Ç—å –∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ø–∞–ø–∫—É runtime
docker exec -it shortener-php-1 bash
chmod -R 777 runtime

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
docker-compose exec php vendor/bin/codecept run unit LinkTest
```

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

üëâ http://localhost:8080

## –ê–Ω–∞–ª–∏—Ç–∏–∫–∞: SQL-–∑–∞–ø—Ä–æ—Å
### –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø —Å—Å—ã–ª–æ–∫ –ø–æ –º–µ—Å—è—Ü–∞–º:

```sql
SELECT
    DATE_FORMAT(FROM_UNIXTIME(v.visited_at), '%Y-%m') AS `–ú–µ—Å—è—Ü (–ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ)`,
    l.original_url AS `–°—Å—ã–ª–∫–∞`,
    COUNT(v.id) AS `–ö–æ–ª-–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤`,
    RANK() OVER (PARTITION BY DATE_FORMAT(FROM_UNIXTIME(v.visited_at), '%Y-%m') ORDER BY COUNT(v.id) DESC) AS `–ü–æ–∑–∏—Ü–∏—è –≤ —Ç–æ–ø–µ –º–µ—Å—è—Ü–∞ –ø–æ –ø–µ—Ä–µ—Ö–æ–¥–∞–º`
FROM
    visits v
        JOIN
    links l ON v.link_id = l.id
GROUP BY
    `–ú–µ—Å—è—Ü (–ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ)`, l.original_url
ORDER BY
    `–ú–µ—Å—è—Ü (–ø–µ—Ä–µ—Ö–æ–¥–∞ –ø–æ —Å—Å—ã–ª–∫–µ)` DESC, `–ö–æ–ª-–≤–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤` DESC;
